(this["webpackJsonptsundiary2-rewrite"]=this["webpackJsonptsundiary2-rewrite"]||[]).push([[0],{215:function(t,e){},320:function(t,e,n){},321:function(t,e,n){"use strict";n.r(e);var a=n(4),r=n(2),i=n.n(r),c=n(26),s=n.n(c),o=n(19),u=n(82);u.a.initializeApp({apiKey:"AIzaSyAXGLAVbKjEFWdZARALl3Ij4-tvdzcUabM",authDomain:"tsundiary2.firebaseapp.com",databaseURL:"https://tsundiary2-default-rtdb.firebaseio.com",projectId:"tsundiary2",storageBucket:"tsundiary2.appspot.com",messagingSenderId:"290115154182",appId:"1:290115154182:web:6bb486cb96989721b6ae87",measurementId:"G-R0CZR1HP7L"});var h=u.a.database(),d=new u.a.auth.GoogleAuthProvider,l=(n(202),n(203),n(257),n(18)),j=n(187),b=n(337),f=function(t){return{type:"SET_THEME",theme:t}},O=function(t){return function(e){var n=t.split("@")[0];h.ref("users/".concat(n,"/theme")).once("value").then((function(t){var n=t.val()||"Default";e(f(n))}))}},v=Object(o.b)(void 0,(function(t){return{startLogin:function(){return t((function(){return u.a.auth().signInWithPopup(d)}))}}}))((function(t){var e=t.startLogin;return Object(a.jsx)("div",{className:"login",children:Object(a.jsx)(b.a,{size:"large",variant:"outlined",onClick:e,children:"Log in with Google"})})})),p=n(64),m=n(65),y=n(29),g=n(70),x=n(68),E=n(91),T=n.n(E),k=n(189),w=n(8),D=n.n(w),S=n(9),I=function(t){return function(e,n){var a=n().auth.user.email.split("@")[0],r=D()().startOf("day").format();return e(function(t){return{type:"EDIT_TODAYS_ENTRY",date:D()().startOf("day").format(),updates:t}}(t)),t.content?h.ref("users/".concat(a,"/entries/").concat(r)).set(t):h.ref("users/".concat(a,"/entries/").concat(r)).remove()}},C=function(t){return function(e){var n=t.split("@")[0];return h.ref("users/".concat(n,"/entries")).once("value").then((function(t){var n=[];t.forEach((function(t){n.push(Object(S.a)({date:t.key},t.val()))})),e(function(t){return{type:"SET_ENTRIES",entries:t}}(n))}))}},P=function(t){Object(g.a)(n,t);var e=Object(x.a)(n);function n(t){var a;return Object(p.a)(this,n),(a=e.call(this,t)).createMarkup=a.createMarkup.bind(Object(y.a)(a)),a}return Object(m.a)(n,[{key:"createMarkup",value:function(t){return{__html:T()(t)}}},{key:"render",value:function(){var t=this,e=this.props,n=e.relativeDates,r=e.filteredEntries.sort((function(t,e){return D()(e.date).valueOf()-D()(t.date).valueOf()})).map((function(e){return Object(a.jsxs)("div",{className:"entry",children:[Object(a.jsx)("div",{className:"heading",children:n?D()(e.date).endOf("day").fromNow():D()(e.date).format("LL")}),Object(a.jsx)("div",{dangerouslySetInnerHTML:t.createMarkup(e.content)})]},e.date)}));return Object(a.jsx)("div",{className:"entry-wrapper",children:r.length>0?r:n?Object(a.jsx)("p",{children:"Once you have a history of entries, I'll show them to you at certain intervals."}):Object(a.jsx)("p",{children:"There are no entries to show."})})}}]),n}(i.a.Component),_=["I'm only here because I have nothing else to do, that's all!","So, how have you been wasting your time lately?","I'll forgive you, but just this once, got it?","Could you be any more clueless?","It's your privilege that I'm wasting my time listening to you...","How was your day? Not that I care or anything...","So, how did it go? Not that I'm expecting much!","You look good today! For once...","B-baka baka baka!","Let me know if anything's bothering you, okay?","How was your day?","I-it's not like I'm listening to you because I like you or anything...","Don't get me wrong, it's not like I'm worried about you.","It's cute how you have no idea what's going on around you.","Tell me about your day!","I love listening to you!","M-may I have a hug?","W-would you like a hug?","You may not know this, but you have many admirers!","If you think I'm gonna miss you, think again.","... did you manage to accomplish anything today?"],N=function(t){Object(g.a)(n,t);var e=Object(x.a)(n);function n(t){var a;return Object(p.a)(this,n),(a=e.call(this,t)).state={showPreview:!1,randomPrompt:_[Math.floor(Math.random()*_.length)]},a.handleChange=a.handleChange.bind(Object(y.a)(a)),a.togglePreview=a.togglePreview.bind(Object(y.a)(a)),a.createMarkup=a.createMarkup.bind(Object(y.a)(a)),a.filterEntries=a.filterEntries.bind(Object(y.a)(a)),a}return Object(m.a)(n,[{key:"componentDidMount",value:function(){var t=this.props,e=t.email,n=t.startSetEntries,a=t.startGetTheme;n(e),a(e),this.interval=setInterval((function(){n(e)}),5e3)}},{key:"componentWillUnmount",value:function(){clearInterval(this.interval)}},{key:"handleChange",value:function(t){var e=t.target.value;this.props.startEditTodaysEntry({content:e})}},{key:"togglePreview",value:function(){this.setState((function(t){return{showPreview:!t.showPreview}}))}},{key:"createMarkup",value:function(t){return{__html:T()(""===t?"You haven't written anything.":t)}}},{key:"filterEntries",value:function(t){return t.filter((function(t){for(var e=0,n=[D()().startOf("day").subtract(1,"days"),D()().startOf("day").subtract(7,"days"),D()().startOf("day").subtract(1,"months"),D()().startOf("day").subtract(6,"months"),D()().startOf("day").subtract(1,"years")];e<n.length;e++){if(n[e].isSame(D()(t.date),"day"))return!0}return!1}))}},{key:"render",value:function(){var t=this.props.entries,e=this.state.randomPrompt,n=this.props.entries.find((function(t){return t.date===D()().startOf("day").format()})),r=n?n.content:"";return Object(a.jsxs)("div",{children:[Object(a.jsxs)("div",{className:"editor",children:[Object(a.jsx)(k.a,{minRows:5,placeholder:e,onChange:this.handleChange,value:r}),this.state.showPreview?Object(a.jsxs)("div",{className:"entry",children:[Object(a.jsx)("div",{id:"preview-heading",className:"heading",onClick:this.togglePreview,children:"Hide Preview"}),Object(a.jsx)("div",{dangerouslySetInnerHTML:this.createMarkup(r)})]}):Object(a.jsx)("div",{className:"entry",children:Object(a.jsx)("div",{id:"preview-heading",className:"heading",onClick:this.togglePreview,children:"Show Preview"})})]}),Object(a.jsx)(P,{relativeDates:!0,filteredEntries:this.filterEntries(t)})]})}}]),n}(i.a.Component),A=Object(o.b)((function(t){return{entries:t.entries,email:t.auth.user.email}}),(function(t){return{startEditTodaysEntry:function(e){return t(I(e))},startSetEntries:function(e){return t(C(e))},startGetTheme:function(e){return t(O(e))}}}))(N),L=n(45),R=n(181),F=n(182),M=n.n(F),G=n(92),Y=function(t){var e=t.entries,n=t.onDatesChange,r={};e.forEach((function(t){var e=D()(t.date).year(),n=D()(t.date).month();r[e]?r[e].push(n):r[e]=[n]}));var i=Object.keys(r).sort((function(t,e){return e-t})).map((function(t){var e=new Set(r[t]),i=Object(G.a)(e).sort((function(t,e){return t-e})).map((function(e){return Object(a.jsxs)("a",{onClick:function(){return n({startDate:D()([t,e]).startOf("month"),endDate:D()([t,e]).endOf("month")})},children:[D.a.monthsShort(e)," "]},"".concat(t,"-").concat(e))}));return Object(a.jsxs)("div",{children:[t,": ",i]},t)}));return Object(a.jsx)("div",{className:"years-and-months",children:i})},U=function(t){Object(g.a)(n,t);var e=Object(x.a)(n);function n(t){var a;return Object(p.a)(this,n),(a=e.call(this,t)).state={isPrivate:!1,calendarFocused:null},a.filterEntries=a.filterEntries.bind(Object(y.a)(a)),a.onDatesChange=a.onDatesChange.bind(Object(y.a)(a)),a.onFocusChange=a.onFocusChange.bind(Object(y.a)(a)),a.onTextFilterChange=a.onTextFilterChange.bind(Object(y.a)(a)),a}return Object(m.a)(n,[{key:"componentDidMount",value:function(){var t=this,e=this.props,n=e.match,a=e.startSetEntries,r=e.startGetTheme;a(n.params.username).then((function(){r(n.params.username)})).catch((function(){t.setState({isPrivate:!0})}))}},{key:"filterEntries",value:function(t){var e=this;return t.filter((function(t){var n=e.props.filters,a=n.startDate,r=n.endDate,i=n.textFilter,c=!a||a.startOf("day").isSameOrBefore(t.date),s=!r||r.endOf("day").isSameOrAfter(t.date),o=t.content.toLowerCase().includes(i.toLowerCase());return c&&s&&o}))}},{key:"onDatesChange",value:function(t){var e=t.startDate,n=t.endDate,a=this.props,r=a.setStartDate,i=a.setEndDate;r(e),i(n)}},{key:"onFocusChange",value:function(t){this.setState((function(){return{calendarFocused:t}}))}},{key:"onTextFilterChange",value:function(t){(0,this.props.setTextFilter)(t.target.value)}},{key:"render",value:function(){var t=this.state.isPrivate,e=this.props,n=e.entries,r=e.match,i=this.props.filters,c=i.startDate,s=i.endDate;return Object(a.jsx)("div",{style:{marginTop:30},children:t?Object(a.jsx)("p",{children:"This user's tsundiary is private."}):Object(a.jsxs)("div",{children:[Object(a.jsx)("div",{className:"username",children:Object(a.jsx)(L.a,{to:"/users/".concat(r.params.username),children:r.params.username})}),Object(a.jsxs)("div",{className:"icon-aligned",children:[Object(a.jsx)(M.a,{style:{width:18,height:18,marginRight:3}}),Object(a.jsxs)("span",{children:[n.length," days of entries"]})]}),Object(a.jsx)(Y,{entries:n,onDatesChange:this.onDatesChange}),Object(a.jsxs)("div",{className:"filter-wrapper",children:[Object(a.jsx)("input",{type:"text",placeholder:"Search",onChange:this.onTextFilterChange}),Object(a.jsx)("div",{style:{float:"right"},children:Object(a.jsx)(R.DateRangePicker,{startDate:c,startDateId:"start_date_id",endDate:s,endDateId:"end_date_id",onDatesChange:this.onDatesChange,focusedInput:this.state.calendarFocused,onFocusChange:this.onFocusChange,showClearDates:!0,numberOfMonths:1,isOutsideRange:function(){return!1}})})]}),Object(a.jsx)(P,{relativeDates:!1,filteredEntries:this.filterEntries(n)})]})})}}]),n}(i.a.Component),z=Object(o.b)((function(t){return{entries:t.entries,filters:t.filters,email:t.auth.user.email}}),(function(t){return{setStartDate:function(e){return t(function(t){return{type:"SET_START_DATE",startDate:t}}(e))},setEndDate:function(e){return t(function(t){return{type:"SET_END_DATE",endDate:t}}(e))},setTextFilter:function(e){return t(function(t){return{type:"SET_TEXT_FILTER",text:t}}(e))},startSetEntries:function(e){return t(C(e))},startGetTheme:function(e){return t(O(e))}}}))(U),B={Default:{backgroundColor:"#ece6ec"},"Yukino Yukinoshita":{backgroundColor:"#d5eaf2",backgroundImage:"url(/tsundiary2-rewrite/yukino.png)",backgroundSize:"auto 100vh",backgroundRepeat:"no-repeat",backgroundPosition:"left",backgroundAttachment:"fixed"},"Yui Yuigahama":{backgroundColor:"#fadadd",backgroundImage:"url(/tsundiary2-rewrite/yui.png)",backgroundSize:"auto 100vh",backgroundRepeat:"no-repeat",backgroundPosition:"right",backgroundAttachment:"fixed"}},H=Object(o.b)((function(t){return{theme:t.auth.theme,privacy:t.auth.privacy}}),(function(t){return{startSetTheme:function(e){return t(function(t){return function(e,n){var a=n().auth.user.email.split("@")[0];h.ref("users/".concat(a,"/theme")).set(t).then((function(){e(f(t))}))}}(e))},startSetPrivate:function(){return t((function(t,e){var n=e().auth.user.email.split("@")[0];h.ref("users/".concat(n,"/privacy")).set(!0).then((function(){t({type:"SET_PRIVATE"})}))}))},startSetPublic:function(){return t((function(t,e){var n=e().auth.user.email.split("@")[0];h.ref("users/".concat(n,"/privacy")).set(!1).then((function(){t({type:"SET_PUBLIC"})}))}))}}}))((function(t){var e=t.theme,n=t.startSetTheme,r=t.privacy,i=t.startSetPrivate,c=t.startSetPublic,s=Object.keys(B).map((function(t){return Object(a.jsx)("option",{value:t,children:t},t)}));return Object(a.jsxs)("div",{style:{marginTop:30},children:[Object(a.jsxs)("p",{children:[Object(a.jsx)("label",{children:"Theme"}),Object(a.jsx)("select",{value:e,onChange:function(t){return n(t.target.value)},children:s})]}),Object(a.jsxs)("p",{children:[Object(a.jsx)("label",{children:"Privacy"}),Object(a.jsxs)("select",{value:r?"Private":"Public",onChange:function(t){"Private"===t.target.value?i():"Public"===t.target.value&&c()},children:[Object(a.jsx)("option",{value:"Private",children:"Private"}),Object(a.jsx)("option",{value:"Public",children:"Public"})]})]})]})})),V=n(93),X=n(183),W=n.n(X),J=n(184),K=n.n(J),Z=n(185),q=n.n(Z),Q=n(186),$=n.n(Q),tt=Object(o.b)((function(t){return{email:t.auth.user.email}}),(function(t){return{startLogout:function(){return t((function(){return u.a.auth().signOut()}))}}}))((function(t){var e=t.email,n=t.startLogout;return Object(a.jsxs)("div",{className:"navbar",children:[Object(a.jsx)(L.a,{to:"/write",children:Object(a.jsx)(b.a,{children:Object(a.jsx)(W.a,{})})}),Object(a.jsx)(L.a,{to:"/users/".concat(e.split("@")[0]),children:Object(a.jsx)(b.a,{children:Object(a.jsx)(K.a,{})})}),Object(a.jsx)(L.a,{to:"/settings",children:Object(a.jsx)(b.a,{children:Object(a.jsx)(q.a,{})})}),Object(a.jsx)(b.a,{style:{float:"right"},onClick:n,children:Object(a.jsx)($.a,{})})]})})),et=Object(o.b)((function(t){return{isAuthenticated:!!t.auth.user}}))((function(t){var e=t.component,n=t.isAuthenticated,r=Object(V.a)(t,["component","isAuthenticated"]);return Object(a.jsx)(l.b,Object(S.a)(Object(S.a)({},r),{},{component:function(t){return n?Object(a.jsxs)("div",{children:[Object(a.jsx)(tt,{}),Object(a.jsx)(e,Object(S.a)({},t))]}):Object(a.jsx)(l.a,{to:"/"})}}))})),nt={backgroundImage:"url(".concat("/tsundiary2-rewrite","/logo-empty.svg)"),backgroundSize:"75px 75px",width:75,height:75,margin:"40px auto"},at=function(){return Object(a.jsx)("header",{className:"header",style:nt})},rt=Object(o.b)((function(t){return{isAuthenticated:!!t.auth.user}}))((function(t){var e=t.component,n=t.isAuthenticated,r=Object(V.a)(t,["component","isAuthenticated"]);return Object(a.jsx)(l.b,Object(S.a)(Object(S.a)({},r),{},{component:function(t){return n?Object(a.jsx)(l.a,{to:"/write"}):Object(a.jsxs)("div",{children:[Object(a.jsx)(at,{}),Object(a.jsx)(e,Object(S.a)({},t))]})}}))})),it=Object(j.a)(),ct=Object(o.b)((function(t){return{theme:t.auth.theme}}))((function(t){var e=t.theme;return Object(a.jsx)("div",{className:"app",style:B[e],children:Object(a.jsx)("div",{className:"wrapper",children:Object(a.jsx)(l.c,{history:it,basename:"/tsundiary2-rewrite",children:Object(a.jsx)("div",{children:Object(a.jsxs)(l.d,{children:[Object(a.jsx)(rt,{path:"/",component:v,exact:!0}),Object(a.jsx)(et,{path:"/write",component:A}),Object(a.jsx)(et,{path:"/users/:username",component:z}),Object(a.jsx)(et,{path:"/settings",component:H})]})})})})})})),st=n(336),ot=Object(o.b)((function(t){return{theme:t.auth.theme}}))((function(t){var e=t.theme;return Object(a.jsx)("div",{className:"app",style:B[e],children:Object(a.jsx)("div",{className:"loader",children:Object(a.jsx)(st.a,{size:100,thickness:5,style:{color:B[e].backgroundColor}})})})})),ut=n(54),ht=n(188),dt=[],lt=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:dt,e=arguments.length>1?arguments[1]:void 0;switch(e.type){case"ADD_ENTRY":return t.concat(e.entry);case"EDIT_TODAYS_ENTRY":var n=t.find((function(t){return t.date===e.date}));if(n)return t.map((function(t){return t.date===e.date?Object(S.a)(Object(S.a)({},t),e.updates):t})).filter((function(t){return""!==t.content}));var a=Object(S.a)({date:e.date},e.updates);return[a].concat(Object(G.a)(t));case"SET_ENTRIES":return e.entries;default:return t}},jt={startDate:D()().startOf("day").subtract(30,"days"),endDate:D()().startOf("day"),textFilter:""},bt=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:jt,e=arguments.length>1?arguments[1]:void 0;switch(e.type){case"SET_START_DATE":return Object(S.a)(Object(S.a)({},t),{},{startDate:e.startDate});case"SET_END_DATE":return Object(S.a)(Object(S.a)({},t),{},{endDate:e.endDate});case"SET_TEXT_FILTER":return Object(S.a)(Object(S.a)({},t),{},{textFilter:e.text});default:return t}},ft={user:null,theme:"Default",privacy:!0},Ot=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ft,e=arguments.length>1?arguments[1]:void 0;switch(e.type){case"LOGIN":return Object(S.a)(Object(S.a)({},t),{},{user:e.user});case"LOGOUT":return Object(S.a)(Object(S.a)({},t),{},{user:null});case"SET_THEME":return Object(S.a)(Object(S.a)({},t),{},{theme:e.theme});case"SET_PRIVATE":return Object(S.a)(Object(S.a)({},t),{},{privacy:!0});case"SET_PUBLIC":return Object(S.a)(Object(S.a)({},t),{},{privacy:!1});default:return t}},vt=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||ut.d,pt=(n(320),Object(ut.e)(Object(ut.c)({entries:lt,filters:bt,auth:Ot}),vt(Object(ut.a)(ht.a)))),mt=Object(a.jsx)(i.a.StrictMode,{children:Object(a.jsx)(o.a,{store:pt,children:Object(a.jsx)(ct,{})})}),yt=!1,gt=function(){yt||(s.a.render(mt,document.getElementById("root")),yt=!0)};s.a.render(Object(a.jsx)(o.a,{store:pt,children:Object(a.jsx)(ot,{})}),document.getElementById("root")),u.a.auth().onAuthStateChanged((function(t){t?(pt.dispatch(function(t){return{type:"LOGIN",user:t}}(t)),pt.dispatch(O(t.email)),pt.dispatch((function(t,e){var n=e().auth.user.email.split("@")[0];h.ref("users/".concat(n,"/privacy")).once("value").then((function(e){e.val()||void 0===e.val()?t({type:"SET_PRIVATE"}):t({type:"SET_PUBLIC"})}))})),pt.dispatch(C(t.email)).then((function(){gt(),"/"===it.location.pathname&&it.push("/write")}))):(pt.dispatch({type:"LOGOUT"}),pt.dispatch(f("Default")),gt(),it.push("/"))}))}},[[321,1,2]]]);
//# sourceMappingURL=main.980ef210.chunk.js.map