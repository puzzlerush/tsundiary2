(this["webpackJsonptsundiary2-rewrite"]=this["webpackJsonptsundiary2-rewrite"]||[]).push([[0],{215:function(e,t){},320:function(e,t,n){},321:function(e,t,n){"use strict";n.r(t);var a=n(4),r=n(2),i=n.n(r),s=n(26),c=n.n(s),o=n(19),u=n(82);u.a.initializeApp({apiKey:"AIzaSyAXGLAVbKjEFWdZARALl3Ij4-tvdzcUabM",authDomain:"tsundiary2.firebaseapp.com",databaseURL:"https://tsundiary2-default-rtdb.firebaseio.com",projectId:"tsundiary2",storageBucket:"tsundiary2.appspot.com",messagingSenderId:"290115154182",appId:"1:290115154182:web:6bb486cb96989721b6ae87",measurementId:"G-R0CZR1HP7L"});var h=u.a.database(),d=new u.a.auth.GoogleAuthProvider,l=(n(202),n(203),n(257),n(9)),j=n(48),b=n(49),f=n(27),O=n(51),v=n(50),p=n(41),m=n(18),y=n(187),g=n(337),x=function(e){return{type:"SET_THEME",theme:e}},E=function(e){return function(t){var n=e.split("@")[0];h.ref("users/".concat(n,"/theme")).once("value").then((function(e){var n=e.val()||"Default";t(x(n))}))}},w=Object(o.b)(void 0,(function(e){return{startLogin:function(){return e((function(){return u.a.auth().signInWithPopup(d)}))}}}))((function(e){var t=e.startLogin;return Object(a.jsx)("div",{className:"login",children:Object(a.jsx)(g.a,{size:"large",variant:"outlined",onClick:t,children:"Log in with Google"})})})),k=n(91),T=n.n(k),D=n(189),S=n(8),I=n.n(S),C=function(e){return function(t,n){var a=n().auth.user.email.split("@")[0],r=I()().startOf("day").format();return t(function(e){return{type:"EDIT_TODAYS_ENTRY",date:I()().startOf("day").format(),updates:e}}(e)),e.content?h.ref("users/".concat(a,"/entries/").concat(r)).set(e):h.ref("users/".concat(a,"/entries/").concat(r)).remove()}},P=function(e){return function(t){var n=e.split("@")[0];return h.ref("users/".concat(n,"/entries")).once("value").then((function(e){var n=[];e.forEach((function(e){n.push(Object(l.a)({date:e.key},e.val()))})),t(function(e){return{type:"SET_ENTRIES",entries:e}}(n))}))}},_=function(e){Object(O.a)(n,e);var t=Object(v.a)(n);function n(e){var a;return Object(j.a)(this,n),(a=t.call(this,e)).createMarkup=a.createMarkup.bind(Object(f.a)(a)),a}return Object(b.a)(n,[{key:"createMarkup",value:function(e){return{__html:T()(e)}}},{key:"render",value:function(){var e=this,t=this.props,n=t.relativeDates,r=t.filteredEntries.sort((function(e,t){return I()(t.date).valueOf()-I()(e.date).valueOf()})).map((function(t){return Object(a.jsxs)("div",{className:"entry",children:[Object(a.jsx)("div",{className:"heading",children:n?I()(t.date).endOf("day").fromNow():I()(t.date).format("LL")}),Object(a.jsx)("div",{dangerouslySetInnerHTML:e.createMarkup(t.content)})]},t.date)}));return Object(a.jsx)("div",{className:"entry-wrapper",children:r.length>0?r:n?Object(a.jsx)("p",{children:"Once you have a history of entries, I'll show them to you at certain intervals."}):Object(a.jsx)("p",{children:"There are no entries to show."})})}}]),n}(i.a.Component),N=["I'm only here because I have nothing else to do, that's all!","So, how have you been wasting your time lately?","I'll forgive you, but just this once, got it?","Could you be any more clueless?","It's your privilege that I'm wasting my time listening to you...","How was your day? Not that I care or anything...","So, how did it go? Not that I'm expecting much!","You look good today! For once...","B-baka baka baka!","Let me know if anything's bothering you, okay?","How was your day?","I-it's not like I'm listening to you because I like you or anything...","Don't get me wrong, it's not like I'm worried about you.","It's cute how you have no idea what's going on around you.","Tell me about your day!","I love listening to you!","M-may I have a hug?","W-would you like a hug?","You may not know this, but you have many admirers!","If you think I'm gonna miss you, think again.","... did you manage to accomplish anything today?"],L=function(e){Object(O.a)(n,e);var t=Object(v.a)(n);function n(e){var a;return Object(j.a)(this,n),(a=t.call(this,e)).state={showPreview:!1,randomPrompt:N[Math.floor(Math.random()*N.length)]},a.handleChange=a.handleChange.bind(Object(f.a)(a)),a.togglePreview=a.togglePreview.bind(Object(f.a)(a)),a.createMarkup=a.createMarkup.bind(Object(f.a)(a)),a.filterEntries=a.filterEntries.bind(Object(f.a)(a)),a}return Object(b.a)(n,[{key:"componentDidMount",value:function(){var e=this.props,t=e.email,n=e.startSetEntries,a=e.startGetTheme;n(t),a(t),this.interval=setInterval((function(){n(t)}),5e3)}},{key:"componentWillUnmount",value:function(){clearInterval(this.interval)}},{key:"handleChange",value:function(e){var t=e.target.value;this.props.startEditTodaysEntry({content:t})}},{key:"togglePreview",value:function(){this.setState((function(e){return{showPreview:!e.showPreview}}))}},{key:"createMarkup",value:function(e){return{__html:T()(""===e?"You haven't written anything.":e)}}},{key:"filterEntries",value:function(e){return e.filter((function(e){for(var t=0,n=[I()().startOf("day").subtract(1,"days"),I()().startOf("day").subtract(7,"days"),I()().startOf("day").subtract(1,"months"),I()().startOf("day").subtract(6,"months"),I()().startOf("day").subtract(1,"years")];t<n.length;t++){if(n[t].isSame(I()(e.date),"day"))return!0}return!1}))}},{key:"render",value:function(){var e=this.props.entries,t=this.state.randomPrompt,n=this.props.entries.find((function(e){return e.date===I()().startOf("day").format()})),r=n?n.content:"";return Object(a.jsxs)("div",{children:[Object(a.jsxs)("div",{className:"editor",children:[Object(a.jsx)(D.a,{minRows:5,placeholder:t,onChange:this.handleChange,value:r}),this.state.showPreview?Object(a.jsxs)("div",{className:"entry",children:[Object(a.jsx)("div",{id:"preview-heading",className:"heading",onClick:this.togglePreview,children:"Hide Preview"}),Object(a.jsx)("div",{dangerouslySetInnerHTML:this.createMarkup(r)})]}):Object(a.jsx)("div",{className:"entry",children:Object(a.jsx)("div",{id:"preview-heading",className:"heading",onClick:this.togglePreview,children:"Show Preview"})})]}),Object(a.jsx)(_,{relativeDates:!0,filteredEntries:this.filterEntries(e)})]})}}]),n}(i.a.Component),A=Object(o.b)((function(e){return{entries:e.entries,email:e.auth.user.email}}),(function(e){return{startEditTodaysEntry:function(t){return e(C(t))},startSetEntries:function(t){return e(P(t))},startGetTheme:function(t){return e(E(t))}}}))(L),R=n(181),M=n(182),F=n.n(M),G=n(92),Y=function(e){var t=e.entries,n=e.onDatesChange,r={};t.forEach((function(e){var t=I()(e.date).year(),n=I()(e.date).month();r[t]?r[t].push(n):r[t]=[n]}));var i=Object.keys(r).sort((function(e,t){return t-e})).map((function(e){var t=new Set(r[e]),i=Object(G.a)(t).sort((function(e,t){return e-t})).map((function(t){return Object(a.jsxs)("a",{onClick:function(){return n({startDate:I()([e,t]).startOf("month"),endDate:I()([e,t]).endOf("month")})},children:[I.a.monthsShort(t)," "]},"".concat(e,"-").concat(t))}));return Object(a.jsxs)("div",{children:[e,": ",i]},e)}));return Object(a.jsx)("div",{className:"years-and-months",children:i})},z=function(e){Object(O.a)(n,e);var t=Object(v.a)(n);function n(e){var a;return Object(j.a)(this,n),(a=t.call(this,e)).state={isPrivate:!1,calendarFocused:null},a.filterEntries=a.filterEntries.bind(Object(f.a)(a)),a.onDatesChange=a.onDatesChange.bind(Object(f.a)(a)),a.onFocusChange=a.onFocusChange.bind(Object(f.a)(a)),a.onTextFilterChange=a.onTextFilterChange.bind(Object(f.a)(a)),a}return Object(b.a)(n,[{key:"componentDidMount",value:function(){var e=this,t=this.props,n=t.match,a=t.startSetEntries,r=t.startGetTheme;a(n.params.username).then((function(){r(n.params.username)})).catch((function(){e.setState({isPrivate:!0})}))}},{key:"filterEntries",value:function(e){var t=this;return e.filter((function(e){var n=t.props.filters,a=n.startDate,r=n.endDate,i=n.textFilter,s=!a||a.startOf("day").isSameOrBefore(e.date),c=!r||r.endOf("day").isSameOrAfter(e.date),o=e.content.toLowerCase().includes(i.toLowerCase());return s&&c&&o}))}},{key:"onDatesChange",value:function(e){var t=e.startDate,n=e.endDate,a=this.props,r=a.setStartDate,i=a.setEndDate;r(t),i(n)}},{key:"onFocusChange",value:function(e){this.setState((function(){return{calendarFocused:e}}))}},{key:"onTextFilterChange",value:function(e){(0,this.props.setTextFilter)(e.target.value)}},{key:"render",value:function(){var e=this.state.isPrivate,t=this.props,n=t.entries,r=t.match,i=this.props.filters,s=i.startDate,c=i.endDate;return Object(a.jsx)("div",{style:{marginTop:30},children:e?Object(a.jsx)("p",{children:"This user's tsundiary is private."}):Object(a.jsxs)("div",{children:[Object(a.jsx)("div",{className:"username",children:Object(a.jsx)(p.b,{to:"/users/".concat(r.params.username),children:r.params.username})}),Object(a.jsxs)("div",{className:"icon-aligned",children:[Object(a.jsx)(F.a,{style:{width:18,height:18,marginRight:3}}),Object(a.jsxs)("span",{children:[n.length," days of entries"]})]}),Object(a.jsx)(Y,{entries:n,onDatesChange:this.onDatesChange}),Object(a.jsxs)("div",{className:"filter-wrapper",children:[Object(a.jsx)("input",{type:"text",placeholder:"Search",onChange:this.onTextFilterChange}),Object(a.jsx)("div",{style:{float:"right"},children:Object(a.jsx)(R.DateRangePicker,{startDate:s,startDateId:"start_date_id",endDate:c,endDateId:"end_date_id",onDatesChange:this.onDatesChange,focusedInput:this.state.calendarFocused,onFocusChange:this.onFocusChange,showClearDates:!0,numberOfMonths:1,isOutsideRange:function(){return!1}})})]}),Object(a.jsx)(_,{relativeDates:!1,filteredEntries:this.filterEntries(n)})]})})}}]),n}(i.a.Component),H=Object(o.b)((function(e){return{entries:e.entries,filters:e.filters,email:e.auth.user.email}}),(function(e){return{setStartDate:function(t){return e(function(e){return{type:"SET_START_DATE",startDate:e}}(t))},setEndDate:function(t){return e(function(e){return{type:"SET_END_DATE",endDate:e}}(t))},setTextFilter:function(t){return e(function(e){return{type:"SET_TEXT_FILTER",text:e}}(t))},startSetEntries:function(t){return e(P(t))},startGetTheme:function(t){return e(E(t))}}}))(z),U={Default:{backgroundColor:"#ece6ec"},"Yukino Yukinoshita":{backgroundColor:"#d5eaf2",backgroundImage:"url(/tsundiary2/yukino.png)",backgroundSize:"auto 100vh",backgroundRepeat:"no-repeat",backgroundPosition:"left"},"Yui Yuigahama":{backgroundColor:"#fadadd",backgroundImage:"url(/tsundiary2/yui.png)",backgroundSize:"auto 100vh",backgroundRepeat:"no-repeat",backgroundPosition:"right"}},B=Object(o.b)((function(e){return{theme:e.auth.theme,privacy:e.auth.privacy}}),(function(e){return{startSetTheme:function(t){return e(function(e){return function(t,n){var a=n().auth.user.email.split("@")[0];h.ref("users/".concat(a,"/theme")).set(e).then((function(){t(x(e))}))}}(t))},startSetPrivate:function(){return e((function(e,t){var n=t().auth.user.email.split("@")[0];h.ref("users/".concat(n,"/privacy")).set(!0).then((function(){e({type:"SET_PRIVATE"})}))}))},startSetPublic:function(){return e((function(e,t){var n=t().auth.user.email.split("@")[0];h.ref("users/".concat(n,"/privacy")).set(!1).then((function(){e({type:"SET_PUBLIC"})}))}))}}}))((function(e){var t=e.theme,n=e.startSetTheme,r=e.privacy,i=e.startSetPrivate,s=e.startSetPublic,c=Object.keys(U).map((function(e){return Object(a.jsx)("option",{value:e,children:e},e)}));return Object(a.jsxs)("div",{style:{marginTop:30},children:[Object(a.jsxs)("p",{children:[Object(a.jsx)("label",{children:"Theme"}),Object(a.jsx)("select",{value:t,onChange:function(e){return n(e.target.value)},children:c})]}),Object(a.jsxs)("p",{children:[Object(a.jsx)("label",{children:"Privacy"}),Object(a.jsxs)("select",{value:r?"Private":"Public",onChange:function(e){"Private"===e.target.value?i():"Public"===e.target.value&&s()},children:[Object(a.jsx)("option",{value:"Private",children:"Private"}),Object(a.jsx)("option",{value:"Public",children:"Public"})]})]})]})})),V=n(93),W=n(183),X=n.n(W),J=n(184),K=n.n(J),Z=n(185),q=n.n(Z),Q=n(186),$=n.n(Q),ee=Object(o.b)((function(e){return{email:e.auth.user.email}}),(function(e){return{startLogout:function(){return e((function(){return u.a.auth().signOut()}))}}}))((function(e){var t=e.email,n=e.startLogout;return Object(a.jsxs)("div",{className:"navbar",children:[Object(a.jsx)(p.b,{to:"/write",children:Object(a.jsx)(g.a,{children:Object(a.jsx)(X.a,{})})}),Object(a.jsx)(p.b,{to:"/users/".concat(t.split("@")[0]),children:Object(a.jsx)(g.a,{children:Object(a.jsx)(K.a,{})})}),Object(a.jsx)(p.b,{to:"/settings",children:Object(a.jsx)(g.a,{children:Object(a.jsx)(q.a,{})})}),Object(a.jsx)(g.a,{style:{float:"right"},onClick:n,children:Object(a.jsx)($.a,{})})]})})),te=Object(o.b)((function(e){return{isAuthenticated:!!e.auth.user}}))((function(e){var t=e.component,n=e.isAuthenticated,r=Object(V.a)(e,["component","isAuthenticated"]);return Object(a.jsx)(m.b,Object(l.a)(Object(l.a)({},r),{},{component:function(e){return n?Object(a.jsxs)("div",{children:[Object(a.jsx)(ee,{}),Object(a.jsx)(t,Object(l.a)({},e))]}):Object(a.jsx)(m.a,{to:"/"})}}))})),ne={backgroundImage:"url(".concat("/tsundiary2","/logo-empty.svg)"),backgroundSize:"75px 75px",width:75,height:75,margin:"40px auto"},ae=function(){return Object(a.jsx)("header",{className:"header",style:ne})},re=Object(o.b)((function(e){return{isAuthenticated:!!e.auth.user}}))((function(e){var t=e.component,n=e.isAuthenticated,r=Object(V.a)(e,["component","isAuthenticated"]);return Object(a.jsx)(m.b,Object(l.a)(Object(l.a)({},r),{},{component:function(e){return n?Object(a.jsx)(m.a,{to:"/write"}):Object(a.jsxs)("div",{children:[Object(a.jsx)(ae,{}),Object(a.jsx)(t,Object(l.a)({},e))]})}}))})),ie=Object(y.a)({basename:"tsundiary2"}),se=function(e){Object(O.a)(n,e);var t=Object(v.a)(n);function n(e){var a;return Object(j.a)(this,n),(a=t.call(this,e)).state={height:window.innerHeight},a.updateDimensions=a.updateDimensions.bind(Object(f.a)(a)),a}return Object(b.a)(n,[{key:"componentDidMount",value:function(){window.addEventListener("resize",this.updateDimensions)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.updateDimensions)}},{key:"updateDimensions",value:function(){this.setState({height:window.innerHeight})}},{key:"render",value:function(){var e=this.state.height,t=this.props.theme;return Object(a.jsxs)("div",{className:"app",children:[Object(a.jsx)("div",{className:"bg",style:Object(l.a)(Object(l.a)({},U[t]),{},{height:e})}),Object(a.jsx)("div",{className:"wrapper",children:Object(a.jsx)(p.a,{history:ie,children:Object(a.jsx)("div",{children:Object(a.jsxs)(m.d,{children:[Object(a.jsx)(re,{path:"/",component:w,exact:!0}),Object(a.jsx)(te,{path:"/write",component:A}),Object(a.jsx)(te,{path:"/users/:username",component:H}),Object(a.jsx)(te,{path:"/settings",component:B})]})})})})]})}}]),n}(i.a.Component),ce=Object(o.b)((function(e){return{theme:e.auth.theme}}))(se),oe=n(336),ue=Object(o.b)((function(e){return{theme:e.auth.theme}}))((function(e){var t=e.theme;return Object(a.jsx)("div",{className:"app",style:U[t],children:Object(a.jsx)("div",{className:"loader",children:Object(a.jsx)(oe.a,{size:100,thickness:5,style:{color:U[t].backgroundColor}})})})})),he=n(58),de=n(188),le=[],je=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:le,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"ADD_ENTRY":return e.concat(t.entry);case"EDIT_TODAYS_ENTRY":var n=e.find((function(e){return e.date===t.date}));if(n)return e.map((function(e){return e.date===t.date?Object(l.a)(Object(l.a)({},e),t.updates):e})).filter((function(e){return""!==e.content}));var a=Object(l.a)({date:t.date},t.updates);return[a].concat(Object(G.a)(e));case"SET_ENTRIES":return t.entries;default:return e}},be={startDate:I()().startOf("day").subtract(30,"days"),endDate:I()().startOf("day"),textFilter:""},fe=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:be,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_START_DATE":return Object(l.a)(Object(l.a)({},e),{},{startDate:t.startDate});case"SET_END_DATE":return Object(l.a)(Object(l.a)({},e),{},{endDate:t.endDate});case"SET_TEXT_FILTER":return Object(l.a)(Object(l.a)({},e),{},{textFilter:t.text});default:return e}},Oe={user:null,theme:"Default",privacy:!0},ve=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Oe,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"LOGIN":return Object(l.a)(Object(l.a)({},e),{},{user:t.user});case"LOGOUT":return Object(l.a)(Object(l.a)({},e),{},{user:null});case"SET_THEME":return Object(l.a)(Object(l.a)({},e),{},{theme:t.theme});case"SET_PRIVATE":return Object(l.a)(Object(l.a)({},e),{},{privacy:!0});case"SET_PUBLIC":return Object(l.a)(Object(l.a)({},e),{},{privacy:!1});default:return e}},pe=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||he.d,me=(n(320),Object(he.e)(Object(he.c)({entries:je,filters:fe,auth:ve}),pe(Object(he.a)(de.a)))),ye=Object(a.jsx)(i.a.StrictMode,{children:Object(a.jsx)(o.a,{store:me,children:Object(a.jsx)(ce,{})})}),ge=!1,xe=function(){ge||(c.a.render(ye,document.getElementById("root")),ge=!0)};c.a.render(Object(a.jsx)(o.a,{store:me,children:Object(a.jsx)(ue,{})}),document.getElementById("root")),u.a.auth().onAuthStateChanged((function(e){e?(me.dispatch(function(e){return{type:"LOGIN",user:e}}(e)),me.dispatch(E(e.email)),me.dispatch((function(e,t){var n=t().auth.user.email.split("@")[0];h.ref("users/".concat(n,"/privacy")).once("value").then((function(t){t.val()||void 0==t.val()?e({type:"SET_PRIVATE"}):e({type:"SET_PUBLIC"})}))})),me.dispatch(P(e.email)).then((function(){xe(),"/#/"===ie.location.pathname&&ie.push("/#/write")}))):(me.dispatch({type:"LOGOUT"}),me.dispatch(x("Default")),xe(),ie.push("/#/"))}))}},[[321,1,2]]]);
//# sourceMappingURL=main.24d83b7a.chunk.js.map